<!DOCTYPE html>
<html lang="en-us">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    


    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="Hugo借助Travis CI实现GitHub Pages自动部署实践"/>
<meta name="twitter:description" content="这两天把博客从hexo转移到了hugo，并实现了自动化构建，借此机会趁热打铁把过程记录一下。"/>



  	<meta property="og:title" content=" Hugo借助Travis CI实现GitHub Pages自动部署实践 &middot;  云溪部落" />
  	<meta property="og:site_name" content="云溪部落" />
  	<meta property="og:url" content="https://luolvshi.me/hugo/hello-hugo-and-more/" />

    
  	<meta property="og:type" content="article" />

    <meta property="og:article:published_time" content="2016-11-17T16:12:18&#43;08:00" />

    
    <meta property="og:article:tag" content="hugo" />
    
    <meta property="og:article:tag" content="go" />
    
    <meta property="og:article:tag" content="travis" />
    
    

    <title>
       Hugo借助Travis CI实现GitHub Pages自动部署实践 &middot;  云溪部落
    </title>

    <meta name="description" content="代码会唱歌" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://luolvshi.me/hugo/images/favicon.ico">
	  <link rel="apple-touch-icon" href="https://luolvshi.me/hugo/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="https://luolvshi.me/hugo/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://luolvshi.me/hugo/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />


    
      
          <link href="https://luolvshi.me/hugo/index.xml" rel="alternate" type="application/rss+xml" title="云溪部落" />
      
      
    
    <meta name="generator" content="Hugo 0.38.1" />

    <link rel="canonical" href="https://luolvshi.me/hugo/hello-hugo-and-more/" />

    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://luolvshi.me/hugo/">Blog</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://luolvshi.me/hugo/tags/">Tags</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://luolvshi.me/hugo/categories/">Categories</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://luolvshi.me/hugo/about/">About</a>
            </li>
        
    </ul>
    
    
    <a class="subscribe-button icon-feed" href="https://luolvshi.me/hugo/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">





<header class="main-header post-head no-cover">
    <nav class="main-nav overlay clearfix">


      
        <a class="blog-logo" href="https://luolvshi.me/hugo/"><img src="https://luolvshi.me/hugo/images/mzvast.png" alt="Home" /></a>
      
      
          <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
      
    </nav>

    


</header>



<main class="content" role="main">




  <article class="post post">
    <header class="post-header">
      <nav class="breadcrumb">
        
        
        
        
        
        
        
        
        
        
        
      </nav>


        <h1 class="post-title">Hugo借助Travis CI实现GitHub Pages自动部署实践</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2016-11-17T16:12:18&#43;08:00">
            Nov 17, 2016
          </time>
        
         
          <span class="post-tag small"><a href="https://luolvshi.me/hugo/tags/hugo/">#hugo</a></span>
         
          <span class="post-tag small"><a href="https://luolvshi.me/hugo/tags/go/">#go</a></span>
         
          <span class="post-tag small"><a href="https://luolvshi.me/hugo/tags/travis/">#travis</a></span>
         
         
          <span class="post-category"><a href="https://luolvshi.me/hugo/categories/tech/">#tech</a></span>
         
        </section>
    </header>

    <section class="post-content">


<p>这两天把博客从hexo转移到了hugo，并实现了自动化构建，借此机会趁热打铁把过程记录一下。</p>

<h2 id="内容概述">内容概述</h2>

<ul>
<li>hugo的安装</li>
<li>子模块同步</li>
<li>语法高亮</li>
<li>Travis CI配置</li>
</ul>

<h2 id="环境介绍">环境介绍</h2>

<ul>
<li>win10x64 一周年纪念版及更新版本</li>
<li><a href="https://chocolatey.org">chocolatey</a>包管理器</li>
<li><a href="https://git-scm.com/downloads">GitBash</a></li>
<li>Python 2.7+或3.5+</li>
</ul>

<h2 id="hugo的安装">Hugo的安装</h2>

<p><a href="https://gohugo.io/">hugo</a>的安装很简单，管理员权限下输入该命令：</p>

<pre><code>choco install -y hugo
</code></pre>

<p>基本的hugo命令可以参考官网的<a href="https://gohugo.io/overview/quickstart/">快速上手</a>，详解hugo的话又可以单独开篇文章了，本文的重点是自动化部署，赶紧进入重点。</p>

<h2 id="子模块同步">子模块同步</h2>

<p>为什么这里要提到子模块呢？主要原因是hugo自己不带主题，主题是单独放入在themes路径下的。
通常比较合适的做法不是去直接clone别人的主题，而是先fork，然后clone自己的这个目录。
下一条添加子模块的命令：</p>

<pre><code>git submodule add &lt; github url&gt; themes/casper
</code></pre>

<h2 id="语法高亮">语法高亮</h2>

<p>hugo对服务端语法高亮支持的不错，借助于python插件<a href="http://pygments.org/">Pygments</a>。
只要一条命令：</p>

<pre><code>pip install Pygments
</code></pre>

<p>然后在hugo的主配置文件<code>config.toml</code>里面加入相关配置即可，贴上我的供参考：</p>

<pre><code># color-codes for highlighting derived from this style
pygmentsStyle = &quot;xcode&quot;
# true: use pygments-css or false: color-codes directly
pygmentsUseClasses = false
# add syntax highlighting with GitHub flavoured code fences 
PygmentsCodeFences = true
</code></pre>

<h2 id="travis-ci的配置">Travis CI的配置</h2>

<p>看到网上许多的配置搞的来比较复杂，有的还抄来抄去抄错了。</p>

<p>我做了个直观易懂的配置，基本都是常见命令。云端构建一次平均20多秒。
直接上配置文件<code>travis.yml</code>：</p>

<ul>
<li>注意要先生成GH_TOKEN<a href="https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/">(官方教程链接)</a>。也就是在下图所示页面生成一个token：<img src="http://ogscovhkh.bkt.clouddn.com/Picorz-pasteshot--2017-11-14T23:43:35+08:00" alt="" /></li>
<li>然后把这个token添加到<a href="https://travis-ci.org/">Travis</a>的环境变量里去。如下图所示
<img src="http://ogscovhkh.bkt.clouddn.com/Picorz-pasteshot--2017-11-14T23:50:39+08:00" alt="" />
<img src="http://ogscovhkh.bkt.clouddn.com/Picorz-pasteshot--2017-11-14T23:48:23+08:00" alt="" />。</li>
<li>最后简单介绍构建脚本的编写<a href="https://docs.travis-ci.com/user/customizing-the-build/#The-Build-Lifecycle">(构建的生命周期)</a>。由于直接用go get &lt; github url &gt;的方式下载到的不是稳定版，为了和本地环境一致，需要用下载编译后可执行文件的方式，并可以指定版本号。因此，并不需要CI安装了go语言。</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">language: go

go:
  - <span style="color:#1c01ce">1</span>.7.3

branches:
  only:
    - <span style="color:#a90d91">source</span>

env:
 global:
   - GH_REF: github.com/mzvast/mzvast.github.io.git

sudo: required

git:
  submodules: <span style="color:#a90d91">false</span>

<span style="color:#177500"># Use sed to replace the SSH URL with the public URL, then initialize submodules
</span><span style="color:#177500"></span>before_install:
  - sed -i <span style="color:#c41a16">&#39;s/git@github.com:/https:\/\/github.com\//&#39;</span> .gitmodules
  - git submodule update --init --recursive

install:
  - <span style="color:#a90d91">export</span> <span style="color:#000">HUGO_VERSION</span><span style="color:#000">=</span><span style="color:#1c01ce">0</span>.30.2
  - sudo pip install Pygments
  - wget https://github.com/spf13/hugo/releases/download/v<span style="color:#000">$HUGO_VERSION</span>/hugo_<span style="color:#c41a16">${</span><span style="color:#000">HUGO_VERSION</span><span style="color:#c41a16">}</span>_Linux-64bit.tar.gz
  - tar xzf hugo_<span style="color:#c41a16">${</span><span style="color:#000">HUGO_VERSION</span><span style="color:#c41a16">}</span>_Linux-64bit.tar.gz
  - chmod a+x hugo

script:
  - ./hugo

after_script:
  - <span style="color:#a90d91">cd</span> ./public
  - git init
  - git config user.name <span style="color:#c41a16">&#34;mzvast&#34;</span>
  - git config user.email <span style="color:#c41a16">&#34;mzvast@gmail.com&#34;</span>
  - git add .
  - git commit -m <span style="color:#c41a16">&#34;Update docs&#34;</span>
  - git push --force --quiet <span style="color:#c41a16">&#34;https://</span><span style="color:#c41a16">${</span><span style="color:#000">GH_TOKEN</span><span style="color:#c41a16">}</span><span style="color:#c41a16">@</span><span style="color:#c41a16">${</span><span style="color:#000">GH_REF</span><span style="color:#c41a16">}</span><span style="color:#c41a16">&#34;</span> master:master</code></pre></div>
<h2 id="修订说明">修订说明</h2>

<hr />

<table>
<thead>
<tr>
<th align="left">时间</th>
<th align="left">说明</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">2017-11-15</td>
<td align="left">增加插图，更新部分说明性内容。</td>
</tr>

<tr>
<td align="left">2016-11-19</td>
<td align="left">修改Travis配置文件中hugo的下载方式，确保版本为0.17，同时加快构建速度到20秒。</td>
</tr>

<tr>
<td align="left">2017-09-14</td>
<td align="left">更新Travis配置文件中hugo版本。</td>
</tr>
</tbody>
</table>








    </section>


  <footer class="post-footer">


    
    <figure class="author-image">
        <a class="img" href="https://luolvshi.me/hugo/" style="background-image: url(https://luolvshi.me/hugo/images/mzvast.png)"><span class="hidden">Nick Wong's Picture</span></a>
    </figure>
    

    





<section class="author">
  <h4><a href="https://luolvshi.me/hugo/">Nick Wong</a></h4>
  
  <p>The most funny man in the world.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Shanghai, China</span>
    <span class="author-link icon-link"><a href="https://miaocode.tk">https://miaocode.tk</a></span>
  </div>
</section>



    
<section class="share">
  <h4>Share this page</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Hugo%e5%80%9f%e5%8a%a9Travis%20CI%e5%ae%9e%e7%8e%b0GitHub%20Pages%e8%87%aa%e5%8a%a8%e9%83%a8%e7%bd%b2%e5%ae%9e%e8%b7%b5&nbsp;-&nbsp;%e4%ba%91%e6%ba%aa%e9%83%a8%e8%90%bd&amp;url=https%3a%2f%2fluolvshi.me%2fhugo%2fhello-hugo-and-more%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fluolvshi.me%2fhugo%2fhello-hugo-and-more%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fluolvshi.me%2fhugo%2fhello-hugo-and-more%2f&amp;description=Hugo%e5%80%9f%e5%8a%a9Travis%20CI%e5%ae%9e%e7%8e%b0GitHub%20Pages%e8%87%aa%e5%8a%a8%e9%83%a8%e7%bd%b2%e5%ae%9e%e8%b7%b5"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=https%3a%2f%2fluolvshi.me%2fhugo%2fhello-hugo-and-more%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    




  </footer>
</article>

</main>

<aside class="read-next">
  
      <a class="read-next-story" style="background-image: url(https://luolvshi.me/hugo/http://ogscovhkh.bkt.clouddn.com/raspberry-pi-girl.jpg)" href="https://luolvshi.me/hugo/raspberrypi-realvnc/">
          <section class="post">
              <h2>raspberrypi realvnc</h2>
              
          </section>
      </a>
  
  
      <a class="read-next-story prev" style="no-cover" href="https://luolvshi.me/hugo/hello-kcp/">
          <section class="post">
              <h2>树莓派遇上kcptun</h2>
          </section>
      </a>
  
</aside>


    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">云溪部落</a> All rights reserved - 2018</section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="https://luolvshi.me/hugo/js/jquery.js"></script>
    <script type="text/javascript" src="https://luolvshi.me/hugo/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://luolvshi.me/hugo/js/index.js"></script>
    
</body>
</html>

